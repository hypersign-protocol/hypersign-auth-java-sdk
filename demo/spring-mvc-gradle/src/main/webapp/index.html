<!DOCTYPE html>

<html ng-app="fruitsApp">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.qrcode@1.0.3/jquery.qrcode.min.js"></script>
</head>

<body>
<div align="center">
    <h1>Login With QR Code</h1>
    <div id="qrcode"></div>
    <p>
        <button class="webwallet"></button>
    </p>
</div>

</body>
<script>
$(document).ready(function() {
    var host = document.location.host;
    var pathname = document.location.pathname;
    ws = new WebSocket("ws://" +host  + pathname + "hsauth");
    ws.onmessage = function({data }) {
         console.log(data)
        let messageData = JSON.parse(data);
        $("#qrcode").html("");
        if (messageData.op == 'init') {
            $("#qrcode").qrcode({ "width": 100, "height": 100, "text": messageData.data });
        } else if (messageData.op == 'end') {
            ws.close();
            $("#qrcode").hide();
            const authorizationToken = messageData.data.token
            // You can now call 'protected' resource using authorizationToken
        }
        else
        $("#qrcode").qrcode({ "width": 250, "height": 250, "text": messageData.content });
		const weblink = "https://hswallet-stage.netlify.app/deeplink?url=" + messageData.content
        $(".webwallet").html(`<a class="btn " href='${weblink}' target='_blank'>Hypersign Web Wallet</a>`)
      
    };
});
</script>
</html>
